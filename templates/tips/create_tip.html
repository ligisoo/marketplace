{% extends 'base.html' %}

{% block title %}Create Tip - Ligisoo{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 py-6 overflow-x-hidden">

  <!-- Header (compact) -->
  <div class="text-center mb-5">
    <h1 class="text-2xl md:text-3xl font-bold text-foreground leading-tight">Create New Tip</h1>
    <p class="text-sm md:text-base text-muted-foreground">Upload your betslip screenshot to share your winning insights</p>
  </div>

  <!-- Progress Steps (compact) -->
  <div class="mb-6">
    <div class="flex items-center justify-center text-xs md:text-sm">
      <div class="flex items-center text-primary">
        <span class="flex items-center justify-center w-7 h-7 md:w-8 md:h-8 bg-primary text-primary-foreground rounded-full font-semibold shadow-sm">1</span>
        <span class="ml-2 hidden sm:inline">Upload</span>
      </div>
      <div class="flex-1 mx-2 md:mx-4 h-1.5 bg-muted rounded-full max-w-24">
        <div class="h-full bg-primary/40 rounded-full w-1/3"></div>
      </div>
      <div class="flex items-center text-muted-foreground">
        <span class="flex items-center justify-center w-7 h-7 md:w-8 md:h-8 bg-muted text-muted-foreground rounded-full font-medium">2</span>
        <span class="ml-2 hidden sm:inline">Verify</span>
      </div>
      <div class="flex-1 mx-2 md:mx-4 h-1.5 bg-muted rounded-full max-w-24"></div>
      <div class="flex items-center text-muted-foreground">
        <span class="flex items-center justify-center w-7 h-7 md:w-8 md:h-8 bg-muted text-muted-foreground rounded-full font-medium">3</span>
        <span class="ml-2 hidden sm:inline">Go Live</span>
      </div>
    </div>
  </div>

  <!-- Main Form Card -->
  <div class="bg-card border border-border rounded-lg p-5 shadow-sm">
    <form method="post" enctype="multipart/form-data" class="space-y-5">
      {% csrf_token %}

      {% if form.non_field_errors %}
        <div class="bg-destructive/10 border border-destructive/20 text-destructive px-3 py-2 rounded-md text-sm">
          {{ form.non_field_errors }}
        </div>
      {% endif %}

      <!-- Bookmaker -->
      <div class="space-y-1.5">
        <label for="{{ form.bookmaker.id_for_label }}" class="text-sm font-medium text-foreground flex items-center">
          <svg class="w-4 h-4 mr-2 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
          </svg>
          Bookmaker *
        </label>
        <select name="bookmaker" id="{{ form.bookmaker.id_for_label }}" class="form-select" required>
          <option value="">Select bookmaker...</option>
          {% for value, label in form.bookmaker.field.choices %}
            {% if value %}
              <option value="{{ value }}">{{ label }}</option>
            {% endif %}
          {% endfor %}
        </select>
        {% if form.bookmaker.errors %}
          <div class="text-destructive text-xs">{{ form.bookmaker.errors }}</div>
        {% endif %}
        <p class="text-xs text-muted-foreground">Select the bookmaker for your betslip.</p>
      </div>

      <!-- Bet Code -->
      <div class="space-y-1.5">
        <label for="{{ form.bet_code.id_for_label }}" class="text-sm font-medium text-foreground flex items-center">
          <svg class="w-4 h-4 mr-2 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14"></path>
          </svg>
          Bet Code *
        </label>
        <input type="text"
               name="bet_code"
               id="{{ form.bet_code.id_for_label }}"
               class="form-input"
               style="text-transform: uppercase;"
               required
               placeholder="e.g., JYRCAV"
               maxlength="50">
        {% if form.bet_code.errors %}
          <div class="text-destructive text-xs">{{ form.bet_code.errors }}</div>
        {% endif %}
        <p class="text-xs text-muted-foreground">Enter the bet code from your betslip. This will be shared with buyers.</p>
      </div>

      <!-- Price (with quick chips) -->
      <div class="space-y-1.5">
        <label for="{{ form.price.id_for_label }}" class="text-sm font-medium text-foreground flex items-center">
          <svg class="w-4 h-4 mr-2 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
          </svg>
          Tip Price (KES) *
        </label>
        <input type="number"
               name="price"
               id="{{ form.price.id_for_label }}"
               class="form-input"
               min="1" max="1000" required placeholder="e.g. 99">
        {% if form.price.errors %}
          <div class="text-destructive text-xs">{{ form.price.errors }}</div>
        {% endif %}
        <p class="text-xs text-muted-foreground">Min: KES 1, Max: KES 1,000.</p>
      </div>

      <!-- Screenshot Upload -->
      <div class="space-y-1.5">
          <label for="{{ form.screenshot.id_for_label }}" class="text-sm font-medium text-foreground flex items-center">
            <svg class="w-4 h-4 mr-2 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
            </svg>
            Betslip Screenshot *
          </label>

          <div id="upload-area"
               class="upload-area border-2 border-dashed border-border rounded-md p-6 text-center transition-colors">
            <input type="file"
                   name="screenshot"
                   id="{{ form.screenshot.id_for_label }}"
                   class="sr-only"
                   accept="image/*"
                   required>
            <label for="{{ form.screenshot.id_for_label }}" class="cursor-pointer block">
              <svg class="mx-auto h-12 w-12 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
              </svg>
              <div class="mt-3">
                <h4 class="text-sm font-medium text-foreground">Upload Betslip Screenshot</h4>
                <p class="mt-1 text-xs text-muted-foreground">Drag & drop your image here, or click to browse (JPG, PNG up to 5MB)</p>
                <p id="file-name" class="mt-1 text-xs text-foreground/80 hidden"></p>
              </div>
            </label>
          </div>

          {% if form.screenshot.errors %}
            <div class="text-destructive text-xs">{{ form.screenshot.errors }}</div>
          {% endif %}
        </div>

      <!-- Guidelines (icon retained) -->
      <div class="bg-accent/10 border border-accent/20 rounded-md p-4">
        <div class="flex">
          <svg class="w-5 h-5 text-accent flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd"
                  d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                  clip-rule="evenodd"></path>
          </svg>
          <div class="ml-3">
            <h3 class="text-sm font-medium text-foreground mb-1.5">ðŸ“‹ Important Guidelines</h3>
            <div class="text-xs md:text-sm text-muted-foreground space-y-0.5">
              <p>â€¢ Upload a clear, readable screenshot.</p>
              <p>â€¢ Ensure bet code, odds, and match details are visible.</p>
              <p>â€¢ Share only unplayed betslips.</p>
              <p>â€¢ Tips may be reviewed before going live (if unverified).</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Actions -->
      <div class="flex flex-col sm:flex-row gap-2 pt-1">
        <button type="submit"
                class="w-full sm:flex-1 inline-flex items-center justify-center px-5 py-3 bg-primary text-primary-foreground rounded-md font-semibold hover:bg-primary/90 transition-colors">
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
          </svg>
          <span class="hidden sm:inline">Upload & Create Tip</span>
          <span class="sm:hidden">Create Tip</span>
        </button>

        <a href="{% url 'tips:my_tips' %}"
           class="w-full sm:w-auto inline-flex items-center justify-center px-5 py-3 bg-secondary text-secondary-foreground rounded-md font-semibold hover:bg-secondary/80 transition-colors border border-border">
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M6 18L18 6M6 6l12 12"></path>
          </svg>
          Cancel
        </a>
      </div>
    </form>
  </div>

  <!-- How it Works (slightly tighter) -->
  <div class="bg-card border border-border rounded-lg p-5 mt-6">
    <h3 class="text-lg font-semibold text-foreground mb-4 text-center">ðŸš€ How It Works</h3>
    <div class="space-y-3">
      <div class="flex items-start gap-3">
        <div class="flex-shrink-0 w-9 h-9 bg-primary text-primary-foreground rounded-full flex items-center justify-center font-bold">1</div>
        <div>
          <h4 class="text-sm font-medium text-foreground">Upload Your Betslip</h4>
          <p class="text-sm text-muted-foreground">Enter your bet code, set price, and upload screenshot.</p>
        </div>
      </div>
      <div class="flex items-start gap-3">
        <div class="flex-shrink-0 w-9 h-9 bg-accent text-accent-foreground rounded-full flex items-center justify-center font-bold">2</div>
        <div>
          <h4 class="text-sm font-medium text-foreground">Instant Processing (5-9 seconds)</h4>
          <p class="text-sm text-muted-foreground">AI extracts match details, odds, and selections automatically.</p>
        </div>
      </div>
      <div class="flex items-start gap-3">
        <div class="flex-shrink-0 w-9 h-9 bg-primary text-primary-foreground rounded-full flex items-center justify-center font-bold">3</div>
        <div>
          <h4 class="text-sm font-medium text-foreground">Go Live & Earn</h4>
          <p class="text-sm text-muted-foreground">Your tip is published and you start earning immediately!</p>
        </div>
      </div>
    </div>

    <div class="mt-5 pt-4 border-t border-border">
      <div class="grid grid-cols-3 gap-3 text-center">
        <div>
          <div class="text-lg font-bold text-primary">Fast</div>
          <div class="text-[11px] text-muted-foreground">Processing</div>
        </div>
        <div>
          <div class="text-lg font-bold text-accent">60%</div>
          <div class="text-[11px] text-muted-foreground">Your Revenue</div>
        </div>
        <div>
          <div class="text-lg font-bold text-primary">24/7</div>
          <div class="text-[11px] text-muted-foreground">Available</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Drag/drop file upload + filename display -->
<script>
(function () {
  const area = document.getElementById('upload-area');
  const fileInput = document.getElementById('{{ form.screenshot.id_for_label }}');
  const fileNameEl = document.getElementById('file-name');

  if (area && fileInput) {
    ['dragenter','dragover'].forEach(evt =>
      area.addEventListener(evt, e => { e.preventDefault(); area.classList.add('border-primary/60'); })
    );
    ['dragleave','drop'].forEach(evt =>
      area.addEventListener(evt, e => { e.preventDefault(); area.classList.remove('border-primary/60'); })
    );
    area.addEventListener('drop', e => {
      if (e.dataTransfer.files && e.dataTransfer.files[0]) {
        fileInput.files = e.dataTransfer.files;
        fileNameEl.textContent = e.dataTransfer.files[0].name;
        fileNameEl.classList.remove('hidden');
      }
    });
    fileInput.addEventListener('change', () => {
      if (fileInput.files && fileInput.files[0]) {
        fileNameEl.textContent = fileInput.files[0].name;
        fileNameEl.classList.remove('hidden');
      }
    });
  }
})();
</script>
{% endblock %}
